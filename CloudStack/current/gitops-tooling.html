<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GitOps Tooling im EITCO Cloud Stack :: Eitco CloudStack Documentation</title>
    <link rel="canonical" href="https://docs.k8s.projekte.eitco.de/CloudStack/current/gitops-tooling.html">
    <meta name="generator" content="Antora 3.1.12">
<link rel="icon" href="../../_/img/favicon-32x32.png" type="image/png" sizes="32x32">
<link rel="alternate icon" href="../../_/img/favicon.ico" sizes="any">
<link rel="apple-touch-icon" href="../../_/img/apple-touch-icon.png">
<meta name="theme-color" content="#137080">

<link rel="stylesheet" href="../../_/css/site.css">
<link rel="stylesheet" href="../../_/css/eitco-header.css">
  </head>
  <body class="article">
<header class="header header--brand">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a class="brand-link brand-logo" href="https://www.eitco.de" rel="noopener" aria-label="EITCO">
          <img src="../../_/img/eitco_Wortmarke_Color_weiss.png" alt="EITCO" height="32" loading="eager">
        </a>
        <span class="separator">//</span>
        <a class="docs-link" href="https://docs.k8s.projekte.eitco.de">CloudStack Docs</a>
      </div>

      <button class="navbar-burger" data-target="topbar-nav" aria-label="menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>
    </div>

    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">

        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="https://github.com/eitco" rel="noopener">Repositories</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/eitco/argo-hub" rel="noopener">Argo Hub</a>
            <hr class="navbar-divider">
            <a class="navbar-item" href="https://github.com/eitco?q=argo-repo&type=all&language=&sort=" rel="noopener">Cluster Repositories</a>
            <hr class="navbar-divider">
            <a class="navbar-item has-label" href="https://github.com/orgs/eitco/packages" rel="noopener">
              Container Registry <small>GHCR</small>
            </a>
          </div>
        </div>

        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Zusammenarbeit</div>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item has-label" href="https://eitco.atlassian.net/wiki/spaces/CCC/overview" rel="noopener">
              Confluence <small>Docs</small>
            </a>
            <hr class="navbar-divider">
            <a class="navbar-item has-label" href="https://tracking.eitco.de/secure/RapidBoard.jspa?rapidView=717#" rel="noopener">
              Jira <small>Tickets</small>
            </a>
            <hr class="navbar-divider">
            <a class="navbar-item has-label" href="https://tracking.eitco.de/secure/PortfolioPlanView.jspa?id=19&sid=21&vid=73#plan/backlog" rel="noopener">
              Roadmap <small>Jira Plan</small>
            </a>
          </div>
        </div>

        <div class="navbar-item search hide-for-print">
            <input id="search-input" type="text" placeholder="Search the docs">
        </div>

        <div class="navbar-item">
          <a class="button contact-btn" href="mailto:kubernetes@eitco.de" aria-label="Kontakt Platform Team">
            Kontakt
          </a>
        </div>

        <a class="navbar-item navbar-item--icon" href="https://github.com/eitco" rel="noopener" aria-label="EITCO on GitHub">
          <span class="icon">
            <svg aria-hidden="true" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg"
                 viewBox="0 0 24 24" width="22" height="22" focusable="false">
              <path fill="currentColor"
                d="M12 .5a11.5 11.5 0 0 0-3.64 22.42c.58.11.79-.25.79-.56v-2.1c-3.22.7-3.9-1.36-3.9-1.36-.53-1.35-1.3-1.71-1.3-1.71-1.06-.72.08-.71.08-.71 1.17.08 1.79 1.2 1.79 1.2 1.04 1.78 2.74 1.27 3.4.97.11-.76.41-1.27.74-1.56-2.57-.3-5.28-1.29-5.28-5.74 0-1.27.46-2.31 1.2-3.13-.12-.3-.52-1.52.11-3.16 0 0 .98-.31 3.2 1.19a11.1 11.1 0 0 1 5.82 0c2.22-1.5 3.2-1.19 3.2-1.19.64 1.64.24 2.86.12 3.16.75.82 1.2 1.86 1.2 3.13 0 4.46-2.72 5.44-5.31 5.73.42.36.8 1.07.8 2.16v3.21c0 .31.21.68.8.56A11.5 11.5 0 0 0 12 .5z"/>
            </svg>
          </span>
        </a>

      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="CloudStack" data-version="1.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="index.html">Eitco CloudStack</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Übersicht</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Eitco CloudStack</span>
    <span class="version">1.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="index.html">Eitco CloudStack</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">1.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Eitco CloudStack</a></li>
    <li><a href="gitops-tooling.html">GitOps Tooling im EITCO Cloud Stack</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="https://github.com/eitco/argo-hub/edit/feature/nexus-upload/docs/modules/ROOT/pages/gitops-tooling.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">GitOps Tooling im EITCO Cloud Stack</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_architektur_übersicht">Architektur Übersicht</a>
<ul class="sectlevel2">
<li><a href="#_hub">Hub</a></li>
<li><a href="#_spoke">Spoke</a></li>
</ul>
</li>
<li><a href="#_repositories_und_namenskonvention">Repositories und Namenskonvention</a></li>
<li><a href="#_release_strategie">Release-Strategie</a></li>
<li><a href="#_wichtige_konzepte_in_argocd">Wichtige Konzepte in ArgoCD</a></li>
<li><a href="#_weiterführende_links">Weiterführende Links</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Unser ArgoHub verfolgt eine Hub&amp;Spoke-Implementierung zur zentralisierten Verwaltung von Kubernetes-Clustern und deren Anwendungen. Ziel ist es, eine skalierbare, automatisierte und nachvollziehbare Bereitstellung von Ressourcen und Konfigurationen zu ermöglichen.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architektur_übersicht"><a class="anchor" href="#_architektur_übersicht"></a>Architektur Übersicht</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Übersicht unserer Architektur mit ArgoCD, Cluster API und automatischer Test-Umgebung:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/architecture-overview.png" alt="ArgoHub Architektur Übersicht" width="600" height="400">
</div>
</div>
<div class="sect2">
<h3 id="_hub"><a class="anchor" href="#_hub"></a>Hub</h3>
<div class="paragraph">
<p>Es gibt eine zentrale ArgoCD Instanz (in unserem Falle auf dem Management-Cluster), welches gewisse eigene Komponenten und deren Konfigurationen verwalten und bereitstellen kann. Zusätlich ist der Management-Cluster verantwortlich für die Erstellung und den Aufbau von neuen Workload-Clustern. Die Workload-Cluster werden via ClusterAPI provisioniert und anschließend durch ArgoWorkflows im ArgoHub registriert und mit einer eigenen ArgoCD Instanz bestück. Die Workload-Cluster installieren sich dann sozusagen selbstständig aus ihrem eigenen Git-Repository, welches durch den ArgoHub automatisch erstellt wird. Aufgrund dieser Architektur erscheinen Workload-Cluster als ArgoCD Applications im Management-Cluster.</p>
</div>
<div class="paragraph">
<p>Die zwei wichtigesten Aufgaben des Hubs sind, abgesehen von der Cluster-Provisionierung:
1. Kubernetes Updates
2. Bereitstellung von zentralen "statischen" Secrets, die in allen Clustern benötigt werden. Diese werden über eine Spiffe/Spire Authentifizierung und Synchronisation der Secrets per External Secrets Operator in OpenBao gespeichert.</p>
</div>
<div class="paragraph">
<p>Wir nutzen im Hub folgende Argo-Komponenten:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ArgoCD (auch im Workload-Cluster)</p>
</li>
<li>
<p>Rollouts</p>
</li>
<li>
<p>Events</p>
</li>
<li>
<p>Workflows</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_spoke"><a class="anchor" href="#_spoke"></a>Spoke</h3>
<div class="paragraph">
<p>Neue Workload-Cluster, provisioniert via ClusterAPI, werden durch den ArgoHub verwaltet. Der Inhalt des Clusters ist selbstverwaltet durch ein Cluster spezifisches Repo und eine eigene ArgoCD Instanz. Diese ArgoCD Instanz wird automatisch durch den ArgoHub mit dem entsprechenden Repo verbunden und synchronisiert sich selbstständig.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Repositories basieren auf dem Template-Ordner:<br>
<a href="https://github.com/eitco/argo-hub/tree/main/templates/argo-workload-cluster-repo" class="bare">https://github.com/eitco/argo-hub/tree/main/templates/argo-workload-cluster-repo</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_repositories_und_namenskonvention"><a class="anchor" href="#_repositories_und_namenskonvention"></a>Repositories und Namenskonvention</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Alle unsere Platform Engineering Repositories liegen in der GitHub Organisation <code>eitco</code> und beginnen mit <code>argo-</code>.
Die Workload-Cluster Repositories beginnen mit <code>argo-repo-</code>, gefolgt vom Infrastruktur-Provider und dem Projektkürzel.
Solltest das Repo für ein neues Projekt nicht zu finden sein, ist es entweder noch nicht erstellt worden oder es fehlen die Zugriffsrechte.
In diesem Fall bitte das Platform Engineering Team kontaktieren.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Übersicht: <a href="https://github.com/eitco?q=argo-&amp;type=all&amp;language=&amp;sort=" class="bare">https://github.com/eitco?q=argo-&amp;type=all&amp;language=&amp;sort=</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Namenskonventionen</div>
<p>Da wir unsere Ingress Host Namen von den Cluster Namen ableiten, haben wir eine Namenskonvention für unsere Cluster definiert:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>argo-hub</code>: Das Haupt-Repository für den ArgoHub, welches die Konfiguration und Automatisierung des Hubs sowie die Bestückung der Workload Clusterenthält.</p>
</li>
<li>
<p>Da die Hostnamen unter Umständen öffentlich einsehbar sind, sollten keine sensiblen Informationen im Cluster-Namen enthalten sein.</p>
</li>
<li>
<p>Wir gehen immer von der Struktur <code>argo-repo-&lt;INFRA-PROVIDER&gt;-&lt;PROJECT&gt;-&lt;STAGE&gt;&lt;COUNTER&gt;</code> aus.</p>
<div class="ulist">
<ul>
<li>
<p><code>&lt;INFRA-PROVIDER&gt;</code>: z.B. <code>vsphere</code>, <code>azure</code>, <code>gcp</code></p>
</li>
<li>
<p><code>&lt;PROJECT&gt;</code>: Kürzel für das Projekt, z.B. <code>cstd</code> (Wichtig: Bitte wenn möglich das Jira-Projekt-Kürzel verwenden!)</p>
</li>
<li>
<p><code>&lt;STAGE&gt;</code>: <code>alpha</code>, <code>beta</code>, <code>gamma</code>, es gibt maximal 3 Stages wobei es mehrere Cluster pro Stage geben kann</p>
</li>
<li>
<p><code>&lt;COUNTER&gt;</code>: um mehrere Cluster für dieselbe Umgebung und Stage zu unterscheiden, z.B. <code>1</code>, <code>2</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_release_strategie"><a class="anchor" href="#_release_strategie"></a>Release-Strategie</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Wir planen aktuell 2 Minor-Versionen voll zu supporten. Dieser Stand wird auf eigenen Release Branches gepflegt. Das Release selbst wird duch einen SemVer Tag in Github festgesetzt. Es wird ein Github Release mit Release Notes (automatisiert) gebaut. Der Stand der Plattform wird innerhalb der Cluster immer durch einen Tag angegeben.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Weitere Infos zu unseren Git-Guidelines:<br>
<a href="https://eitco.atlassian.net/wiki/spaces/CCC/pages/2619015169/Git+Guidelines" class="bare">https://eitco.atlassian.net/wiki/spaces/CCC/pages/2619015169/Git+Guidelines</a></p>
</li>
<li>
<p>Migrations-Guides:<br>
<a href="https://eitco.atlassian.net/wiki/spaces/CCC/pages/2593947671/Migration+Guides" class="bare">https://eitco.atlassian.net/wiki/spaces/CCC/pages/2593947671/Migration+Guides</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wichtige_konzepte_in_argocd"><a class="anchor" href="#_wichtige_konzepte_in_argocd"></a>Wichtige Konzepte in ArgoCD</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In ArgoCD gibt es zwei Konzepte, die für die Bereitstellung von Anwendungen von Bedeutung sind: <code>Application</code> und <code>ApplicationSet</code>.</p>
</div>
<div class="ulist">
<div class="title">Application</div>
<ul>
<li>
<p>Eine ArgoCD-Application repräsentiert eine einzelne Anwendung oder einen Dienst, der in einem Kubernetes-Cluster bereitgestellt wird.</p>
</li>
<li>
<p>Jede Application ist mit einem bestimmten Git-Repository und einem Pfad innerhalb dieses Repositories verbunden, in dem die Anwendungsmanifeste gespeichert sind.</p>
</li>
<li>
<p>Die Application-Ressource enthält Informationen über die Anwendung, wie den Zielnamen des Clusters, den Pfad zum Manifest im Git-Repository, die Synchronisationsrichtlinien und weitere Konfigurationsoptionen.</p>
</li>
<li>
<p>ArgoCD verwendet diese Informationen, um den deklarativen Zustand der Anwendung im Git-Repository mit dem tatsächlichen Zustand im Kubernetes-Cluster abzugleichen und sicherzustellen, dass sie übereinstimmen.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">ApplicationSet</div>
<ul>
<li>
<p>Die ApplicationSet ist ein Konzept, das in ArgoCD eingeführt wurde, um die Bereitstellung von Anwendungen in großen und dynamischen Umgebungen zu erleichtern.</p>
</li>
<li>
<p>Während eine einzelne Application eine bestimmte Anwendung repräsentiert, ermöglicht die ApplicationSet das dynamische Erstellen und Aktualisieren mehrerer Applications basierend auf einem Muster oder einer Vorlage.</p>
</li>
<li>
<p>Die ApplicationSet definiert Regeln, nach denen mehrere Anwendungen automatisch erstellt werden können. Diese Regeln können auf Namensmustern, Parametern oder anderen Kriterien basieren.</p>
</li>
<li>
<p>Zum Beispiel kann eine ApplicationSet genutzt werden, um automatisch mehrere Umgebungen (wie Entwicklung, Test und Produktion) basierend auf denselben Anwendungsmanifesten zu erstellen, wobei bestimmte Parameter für jede Umgebung variieren.</p>
</li>
<li>
<p>Die ApplicationSet-Ressource enthält Konfigurationen für das Muster, das genutzt wird, um Anwendungen zu generieren, sowie Optionen für die Synchronisation und Aktualisierung der generierten Anwendungen.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Insgesamt bieten <code>Application</code> und <code>ApplicationSet</code> in ArgoCD Möglichkeiten zur effizienten Verwaltung von Anwendungsdeploys, sei es für einzelne Anwendungen oder für Gruppen von Anwendungen, die einem bestimmten Muster folgen.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_weiterführende_links"><a class="anchor" href="#_weiterführende_links"></a>Weiterführende Links</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>ArgoHub Doku: <a href="https://eitco.atlassian.net/wiki/spaces/CCC/pages/1421738294" class="bare">https://eitco.atlassian.net/wiki/spaces/CCC/pages/1421738294</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="site-footer">
  <div class="footer-inner">
    <nav class="footer-nav">
      <a href="https://www.eitco.de/impressum/">Impressum</a>
      <a href="https://www.eitco.de/datenschutzerklaerung/">Datenschutz</a>
      <a href="https://www.eitco.de/kontakt/">Kontakt</a>
    </nav>

    <div class="footer-social">
      <a href="https://github.com" aria-label="GitHub">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M12 .5a12 12 0 0 0-3.79 23.4c.6.11.82-.26.82-.58v-2.2c-3.34.73-4.04-1.61-4.04-1.61-.55-1.41-1.34-1.79-1.34-1.79-1.09-.75.08-.73.08-.73 1.2.09 1.83 1.24 1.83 1.24 1.07 1.84 2.8 1.31 3.49 1 .11-.78.42-1.31.76-1.61-2.66-.3-5.46-1.33-5.46-5.93 0-1.31.47-2.39 1.24-3.23-.13-.3-.54-1.52.12-3.16 0 0 1.01-.32 3.3 1.23a11.47 11.47 0 0 1 6 0c2.28-1.55 3.3-1.23 3.3-1.23.66 1.64.25 2.86.12 3.16.77.84 1.24 1.92 1.24 3.23 0 4.61-2.8 5.63-5.47 5.93.43.37.81 1.1.81 2.23v3.3c0 .32.22.7.83.58A12 12 0 0 0 12 .5z"/></svg>
      </a>
      <a href="https://de.linkedin.com/company/eitco" aria-label="LinkedIn">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1 4.98 2.12 4.98 3.5zM.5 8.5h4V23h-4V8.5zM8.5 8.5h3.8v2h.05c.53-1 1.84-2.05 3.78-2.05 4.04 0 4.79 2.66 4.79 6.11V23h-4v-6.49c0-1.55-.03-3.54-2.16-3.54-2.16 0-2.49 1.68-2.49 3.42V23h-3.77V8.5z"/></svg>
      </a>
    </div>
  </div>

  <div class="footer-legal">
    <small>©  Eitco. Built with Antora.</small>
  </div>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
